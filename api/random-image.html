<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="robots" content="noindex">
  <title>随机图片重定向</title>
  <script>
    // 获取当前 URL 的查询参数
    const urlParams = new URLSearchParams(window.location.search);
    const category = urlParams.get('category') || 'default';
    
    // 添加调试信息（可选）
    console.log(`请求分类: ${category}`);
    
    // 加载图片索引数据
    fetch('../api/image-data.json')  // 修改为相对路径
      .then(response => {
        if (!response.ok) {
          throw new Error(`HTTP 错误! 状态码: ${response.status}`);
        }
        return response.json();
      })
      .then(data => {
        if (!data || typeof data !== 'object') {
          throw new Error('无效的数据格式');
        }
        // 检查分类是否存在
        if (!data[category]) {
          throw new Error(`分类 "${category}" 不存在`);
        }
        
        // 获取该分类的图片数组
        const images = data[category];
        if (images.length === 0) {
          throw new Error(`分类 "${category}" 中没有图片`);
        }
        
        // 随机选择一张图片
        const randomIndex = Math.floor(Math.random() * images.length);
        const randomImage = images[randomIndex];
        
        console.log(`随机选择图片: ${randomImage}`);
        
        // 重定向到随机图片
        window.location.replace(randomImage);
      })
      .catch(error => {
        // 错误处理
        console.error(error);
        document.body.innerHTML = `
          <h1>错误</h1>
          <p>${error.message}</p>
          <p><a href="/">返回首页</a></p>
        `;
      });
  </script>
</head>
<body>
  <p>正在跳转到随机图片，请稍候...</p>
  <noscript>
    <h1>错误：需要启用 JavaScript</h1>
    <p>此功能需要浏览器启用 JavaScript 支持</p>
  </noscript>
</body>
</html>