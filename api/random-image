<!DOCTYPE html>
<html>
<head>
  <title>随机图片 API</title>
  <script>
    // 获取 URL 参数
    const getQueryParam = (name) => {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name);
    };

    // 主函数
    const redirectToRandomImage = async () => {
      const category = getQueryParam('category') || 'default';
      
      try {
        // 加载图片索引数据
        const response = await fetch('/api/image-data.json');
        const imageData = await response.json();
        
        // 检查分类是否存在
        if (!imageData[category]) {
          throw new Error(`分类 "${category}" 不存在`);
        }
        
        // 获取该分类的图片数组
        const images = imageData[category];
        if (images.length === 0) {
          throw new Error(`分类 "${category}" 中没有图片`);
        }
        
        // 随机选择一张图片
        const randomImage = images[Math.floor(Math.random() * images.length)];
        
        // 重定向到随机图片
        window.location.replace(randomImage);
        
      } catch (error) {
        // 错误处理
        document.body.innerHTML = `
          <h1>错误</h1>
          <p>${error.message}</p>
          <p>可用的分类: ${Object.keys(imageData).join(', ')}</p>
        `;
      }
    };

    // 页面加载时执行
    window.addEventListener('DOMContentLoaded', redirectToRandomImage);
  </script>
</head>
<body>
  <p>正在跳转到随机图片...</p>
</body>
</html>